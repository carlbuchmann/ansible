Building configuration...

Current configuration : 6424 bytes
!
! Last configuration change at 19:30:19 UTC Thu Nov 16 2017 by ********
!
version 16.5
service timestamps debug datetime msec
service timestamps log datetime msec
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
platform console serial
!
hostname branch1-wan
!
boot-start-marker
boot-end-marker
!
!
vrf definition mgmt
 !
 address-family ipv4
 exit-address-family
!
enable secret 5 $1$hELO$h8NEJag5sJHUtUQs7iIuk/
!
no aaa new-model
!
ip vrf IWAN-INET-1
 rd 65511:102
!
ip vrf IWAN-MPLS-1
 rd 65511:101
!
!
!
!
!
!
!
!
!

ip domain name iwan.lab
ip multicast-routing distributed
!
!
!
!
!
!
!
!
!
!
subscriber templating
! 
! 
! 
! 
!
!
!
multilink bundle-name authenticated
!
!
!
!
!
key chain INET-WAN-KEY
 key 1
  key-string inet-wan@154
key chain LAN-KEY
 key 1
  key-string eigrp@LAN
key chain MPLS-WAN-KEY
 key 1
  key-string mpls-wan@154
!
crypto pki trustpoint TP-self-signed-1291577897
 enrollment selfsigned
 subject-name cn=IOS-Self-Signed-Certificate-1291577897
 revocation-check none
 rsakeypair TP-self-signed-1291577897
!
!
crypto pki certificate chain TP-self-signed-1291577897
 certificate self-signed 01
  	quit
!
!
!
!
!
!
!
!
license udi pid CSR1000V sn 9PWSOJHTBLE
diagnostic bootup level minimal
!
spanning-tree extend system-id
!
!
username ******** privilege 15 secret 5 $1$2Bca$sKOoOlmNKWMyh52H/1N0z0
username ansible privilege 15 secret 5 $1$b0ro$JakJ8kLnKRL/E.bY3x39V0
!
redundancy
!
crypto ikev2 proposal AES/GCM/256 
 encryption aes-gcm-256
 prf sha512
 group 19
!
crypto ikev2 policy AES/GCM/256 
 match fvrf any
 proposal AES/GCM/256
!
crypto ikev2 keyring DMVPN-KEYRING
 peer ANY
  address 0.0.0.0 0.0.0.0
  pre-shared-key iWAN@lab#154
 !
!
!
crypto ikev2 profile DMVPN-IKEv2-PROFILE
 description PSK-Profile
 match fvrf any
 match identity remote address 0.0.0.0 
 identity local address 172.21.255.1
 authentication local pre-share
 authentication remote pre-share
 keyring local DMVPN-KEYRING
 dpd 40 5 on-demand
!
!
!
cdp run
!
! 
!
!
!
!
!
!
crypto ipsec security-association replay window-size 1024
!
crypto ipsec transform-set AES256/GCM/TRANSFORM esp-gcm 256 
 mode transport
!
crypto ipsec profile DMVPN-IPSEC-PROFILE
 set transform-set AES256/GCM/TRANSFORM 
 set ikev2-profile DMVPN-IKEv2-PROFILE
!
!
!
!
!
!
! 
! 
!
!
interface Loopback0
 description mgmt
 ip address 172.21.255.1 255.255.255.255
!
interface Tunnel10
 description dmvpn_mpls_1
 bandwidth 100000
 ip address 172.16.101.21 255.255.255.0
 no ip redirects
 ip mtu 1400
 ip nhrp authentication LABmpls1
 ip nhrp network-id 101
 ip nhrp nhs 172.16.101.1 nbma 10.255.20.2 multicast
 ip tcp adjust-mss 1360
 delay 1000
 no nhrp route-watch
 if-state nhrp
 cdp enable
 tunnel source GigabitEthernet2
 tunnel mode gre multipoint
 tunnel key 101
 tunnel vrf IWAN-MPLS-1
 tunnel protection ipsec profile DMVPN-IPSEC-PROFILE
 hold-queue 4096 in
 hold-queue 4096 out
!
interface Tunnel11
 description dmvpn_inet_1
 bandwidth 250000
 ip address 172.16.102.21 255.255.255.0
 no ip redirects
 ip mtu 1400
 ip nhrp authentication LABinet1
 ip nhrp network-id 102
 ip nhrp nhs 172.16.102.1 nbma 192.168.20.2 multicast
 ip tcp adjust-mss 1360
 delay 2000
 no nhrp route-watch
 if-state nhrp
 cdp enable
 tunnel source GigabitEthernet3
 tunnel mode gre multipoint
 tunnel key 102
 tunnel vrf IWAN-INET-1
 tunnel protection ipsec profile DMVPN-IPSEC-PROFILE
 hold-queue 4096 in
 hold-queue 4096 out
!
interface GigabitEthernet1
 vrf forwarding mgmt
 ip address 172.16.1.15 255.255.255.0
 negotiation auto
 no mop enabled
 no mop sysid
!
interface GigabitEthernet2
 description mpls_provider
 bandwidth 100000
 ip vrf forwarding IWAN-MPLS-1
 ip address 10.255.21.2 255.255.255.252
 negotiation auto
 no mop enabled
 no mop sysid
 hold-queue 4096 in
 hold-queue 4096 out
!
interface GigabitEthernet3
 description inet_provider
 bandwidth 250000
 ip vrf forwarding IWAN-INET-1
 ip address 192.168.21.2 255.255.255.252
 negotiation auto
 no mop enabled
 no mop sysid
 hold-queue 4096 in
 hold-queue 4096 out
!
interface GigabitEthernet4
 description branch1-core_ge0/1
 ip address 172.21.0.1 255.255.255.252
 delay 24000
 negotiation auto
 cdp enable
 no mop enabled
 no mop sysid
!
!
router eigrp ENTERPRISE-EIGRP
 !
 address-family ipv4 unicast autonomous-system 100
  !
  af-interface default
   passive-interface
  exit-af-interface
  !
  af-interface GigabitEthernet4
   authentication mode md5
   authentication key-chain LAN-KEY
   no passive-interface
  exit-af-interface
  !
  af-interface Tunnel10
   authentication mode md5
   authentication key-chain MPLS-WAN-KEY
   hello-interval 20
   hold-time 60
   no passive-interface
   stub-site wan-interface
   summary-address 172.21.0.0 255.255.0.0
  exit-af-interface
  !
  af-interface Tunnel11
   authentication mode md5
   authentication key-chain INET-WAN-KEY
   hello-interval 20
   hold-time 60
   no passive-interface
   stub-site wan-interface
   summary-address 172.21.0.0 255.255.0.0
  exit-af-interface
  !
  topology base
   summary-metric 172.21.0.0/16 1000000 10000 255 1 1500
  exit-af-topology
  network 172.16.101.0 0.0.0.255
  network 172.16.102.0 0.0.0.255
  network 172.21.0.0 0.0.0.3
  eigrp router-id 172.21.255.1
 exit-address-family
!

threat-visibility
!
virtual-service csr_mgmt
!
ip forward-protocol nd
no ip http server
ip http authentication local
no ip http secure-server
ip route vrf IWAN-MPLS-1 0.0.0.0 0.0.0.0 10.255.21.1 name mpls-default
ip route vrf IWAN-INET-1 0.0.0.0 0.0.0.0 192.168.21.1 name inet-default
!
ip ssh server algorithm encryption aes128-ctr aes192-ctr aes256-ctr
ip ssh client algorithm encryption aes128-ctr aes192-ctr aes256-ctr
!
!
!
snmp-server community LAB@APICEMro RO
snmp-server community LAB@APICEMrw RW
snmp-server trap-source Loopback0
snmp ifmib ifindex persist
!
!
control-plane
!
 !
 !
 !
 !
!
!
!
!
banner motd ^C
########################################
##  Network-LAB                       ##
##  Configured by Ansible             ##
##  Version .01                       ##
########################################
^C
!
line con 0
 stopbits 1
line vty 0 4
 login local
!
ntp server 172.20.5.101
!
!
!
!
event manager applet ssh-keys
 event syslog occurs 1 pattern "%SYS-5-RESTART: System restarted"
 action 1.0 cli command "enable"
 action 2.0 cli command "********"
 action 3.0 cli command "configure terminal"
 action 4.0 cli command "crypto key generate rsa modulus 1024"
!
end